open Ssp_bridge
let help () = 
  print_endline 
  "
  This program transforms an output of Tracking_bigraph library into a program generating behavior policy as a walk in the state space constructed from that output.
  
  If you see this message it means that you did not provide necessary number of arguments.
  Arguments required for this program are:
  Arg1 - the name of a file containing discovered states (generated by Trackign_bigraph library).
  Arg2 - the name of a file with transitions (generated by Trackign_bigraph library).
  Arg3 - a csv file containing patterns to be found among states (created manually).
  Arg4 - the number of agents in the modelled system.
  Arg5 - the name of a file with reaction rules associated with time they require (created manually).
  Arg6 - the name of a file with control types of agents (created manually).
  Arg7 - the name of the file with states with detected patterns (output of this program).
  Arg8 - the name of the file with transition functions (output of this program).
  Arg9 - the name of the source code file (output of this program).
  Arg10 - (optional) the name of a file with template of the source code, if not provided the default file is \"ssp_template.txt\".
  "
let () =
  if Array.length Sys.argv >= 10 then
    let states_file = Sys.argv.(1)
    and trans_file = Sys.argv.(2)
    and patterns_file = Sys.argv.(3)
    and noa = Sys.argv.(4) |> int_of_string
    and trans2timeshift_file = Sys.argv.(5)
    and ctrls_file = Sys.argv.(6)
    and out_dest_states_file = Sys.argv.(7)
    and out_ssp_input_file = Sys.argv.(8)
    and out_ssp_source_code_file = Sys.argv.(9)
    and template_file = if Array.length Sys.argv = 11 then Sys.argv.(10) else "ssp_template.txt" in
    Facade.all_in_one 
      ~in_states_file:states_file
      ~in_patterns_file:patterns_file
      ~in_trans_file:trans_file
      ~in_react_times_file:trans2timeshift_file
      ~in_ctrls_file:ctrls_file
      ~number_of_agents:noa
      ~in_template_file:template_file
      ~out_dest_states_file
      ~out_ssp_input_file 
      ~out_ssp_source_code_file 
  else
    help ()